<div class="dashboard-layout">
  <!-- Sidebar -->
  <app-sidebar></app-sidebar>

  <!-- Main Content -->
  <div class="main-content">
    <!-- Navbar -->
    <app-navbar></app-navbar>

    <!-- Contenu Principal -->
    <div class="dashboard-container">
      <div class="content-box">
        <div class="container mt-4">
          <h2 class="mb-4">Gestion des Utilisateurs</h2><br>

                <!-- Boutons d'actions -->
       
                <div class="action-buttons">
                  <button class="btn btn-danger" (click)="deleteMultipleUtilisateurs()">
                    <i class="fas fa-trash-alt"></i> Supprimer
                  </button>
                  <button class="btn btn-success" (click)="redirectToInscription()">
                    <i class="fas fa-plus"></i> Ajouter
                  </button>
                  <button class="btn btn-secondary" (click)="csvInput.click()">
                    <i class="fas fa-file-csv"></i> Import CSV
                  </button>
                  <input #csvInput type="file" (change)="importCsv($event)" accept=".csv" style="display: none;">
                  <button class="btn btn-warning" (click)="blockMultipleUtilisateurs()">
                    <i class="fas fa-ban"></i> Bloquer/Débloquer
                  </button>
                  <span class="badge bg-primary">
                    {{ selectedUsers.size }} Sélectionné(s)
                  </span>
                </div>
                <br>



              <!-- Barre de recherche et filtre -->
        <!-- Barre de recherche et filtre -->
        <div class="filter-bar">
          <input
            type="text"
            class="form-control small-search"
            placeholder="Rechercher par Matricule, Nom ou Prénom..."
            [(ngModel)]="searchTerm"
            (input)="applyFilters()"
          />
          <select
            class="form-control small-search"
            [(ngModel)]="selectedRole"
            (change)="applyFilters()"
          >
            <option value="">Tous</option>
            <option value="administrateur">Administrateur</option>
            <option value="agent de sécurité">Agent de Sécurité</option>
            <option value="conducteur">Conducteur</option>
          </select>
        </div>
        

        <!-- Message d'erreur si aucun résultat n'est trouvé -->
        <div *ngIf="noResults" class="alert alert-success" role="alert">
          Aucun résultat pour "{{ searchTerm }}"
        </div>

        <!-- Tableau des utilisateurs -->
        <div class="table-responsive">
          <table class="table table-bordered table-hover">
            <thead class="table-light">
              <tr>
                <th><input type="checkbox" (change)="toggleSelectAll()"></th>
                <th>Matricule</th>
                <th>Prénom et Nom</th>
                <th>Email</th>
                <th>Rôle</th>
                <th>Carte</th>
                <th>Statut</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let utilisateur of utilisateurs">
                <td><input type="checkbox" [checked]="isSelected(utilisateur.id)" (change)="toggleSelection(utilisateur.id)"></td>
                <td>{{ utilisateur.matricule }}</td>
                <td>{{ utilisateur.prenom }} {{ utilisateur.nom }}</td>
                <td>{{ utilisateur.email }}</td>
                <td>{{ utilisateur.role }}</td>
                <td>{{ utilisateur.carte_id }}</td>
                <td>
                  <span [class.text-success]="utilisateur.status === 'Actif'" [class.text-danger]="utilisateur.status === 'Inactif'">
                    {{ utilisateur.status }}
                  </span>
                </td>
                <td class="actions-cell">
                  <button class="btn-sm text-orange" (click)="redirectToModifier(utilisateur.id)" title="Modifier">
                    <i class="fas fa-pencil-alt"></i>
                  </button>
                  <button class="btn-sm text-orange" (click)="deleteUtilisateur(utilisateur.id)" title="Supprimer">
                    <i class="fas fa-trash-alt"></i>
                  </button>
                  <button class="btn-sm text-orange" (click)="blockUtilisateur(utilisateur.id)" title="Bloquer/Débloquer">
                    <i class="fas fa-ban"></i>
                  </button>
                  <button class="btn-sm text-orange" (click)="assignCard(utilisateur.id)" title="Assigner une carte">
                    <i class="fas fa-clipboard"></i>
                  </button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
        
        
          <!-- Pagination -->
          <div class="pagination-modern">
            <button class="pagination-btn" (click)="changePage(currentPage - 1)" [disabled]="currentPage === 1">←</button>
          
            <button
              *ngFor="let i of [].constructor(totalPages); let idx = index"
              class="pagination-btn"
              [class.active]="currentPage === idx + 1"
              (click)="changePage(idx + 1)"
            >
              {{ idx + 1 }}
            </button>
          
            <button class="pagination-btn" (click)="changePage(currentPage + 1)" [disabled]="currentPage === totalPages">→</button>
          </div>
          

        </div>
      </div>
    </div>
  </div>
</div>